@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html {
    scroll-behavior: smooth;
    /* Prevent horizontal overflow on mobile */
    overflow-x: hidden;
    /* Prevent flash of unstyled content during theme switch */
    color-scheme: light dark;
  }

  /* Smooth theme transitions - only for colors, not layout */
  html.transitioning,
  html.transitioning *,
  html.transitioning *::before,
  html.transitioning *::after {
    transition: background-color 300ms ease, color 300ms ease, border-color 300ms ease, fill 300ms ease !important;
  }

  /* Respect user preference for reduced motion on scroll */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  body {
    @apply font-sans text-slate-900 dark:text-slate-100 bg-slate-50 dark:bg-slate-900 antialiased;
    /* Use a single consistent background token (slate-50 = #f8fafc) */
    /* Avoid transition on body bg to prevent flash during theme toggle hydration */
  }

  /* Baseline heading typography scale */
  h1, h2, h3, h4, h5, h6 {
    @apply text-slate-900 dark:text-white;
    text-wrap: balance;
  }

  /* Sensible default for paragraphs */
  p {
    text-wrap: pretty;
  }
}

@layer components {
  /* Reddit-style primary button */
  .btn-primary {
    @apply inline-flex items-center justify-center px-6 py-3 text-base font-semibold text-white
           bg-reddit rounded-full shadow-reddit transition-all duration-200
           hover:bg-reddit-dark hover:shadow-reddit-hover
           focus:outline-none focus:ring-2 focus:ring-reddit focus:ring-offset-2
           disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-reddit
           dark:ring-offset-slate-900;
  }

  /* Reddit-style secondary/outline button */
  .btn-secondary {
    @apply inline-flex items-center justify-center px-6 py-3 text-base font-semibold
           text-reddit bg-white dark:bg-slate-800 border-2 border-reddit rounded-full shadow-reddit
           transition-all duration-200
           hover:bg-reddit-50 dark:hover:bg-slate-700 hover:shadow-reddit-hover
           focus:outline-none focus:ring-2 focus:ring-reddit focus:ring-offset-2
           disabled:opacity-50 disabled:cursor-not-allowed
           dark:ring-offset-slate-900;
  }

  /* Reddit blue accent button */
  .btn-accent {
    @apply inline-flex items-center justify-center px-6 py-3 text-base font-semibold text-white
           bg-secondary-500 rounded-full shadow-reddit transition-all duration-200
           hover:bg-secondary-600 hover:shadow-reddit-hover
           focus:outline-none focus:ring-2 focus:ring-secondary-500 focus:ring-offset-2
           disabled:opacity-50 disabled:cursor-not-allowed
           dark:ring-offset-slate-900;
  }

  /* Reddit-style card */
  .card {
    @apply bg-white dark:bg-slate-800 rounded-lg border border-reddit-gray-200 dark:border-slate-700 shadow-reddit dark:shadow-slate-900/50 p-4 transition-all duration-200;
  }

  .card-interactive {
    @apply card cursor-pointer hover:shadow-reddit-hover dark:hover:shadow-slate-900/70 hover:border-reddit-gray-300 dark:hover:border-slate-600;
  }

  .card-selected {
    @apply card border-2 border-reddit ring-2 ring-reddit-100 dark:ring-orange-900/50;
  }

  /* Reddit-style input */
  .input {
    @apply w-full px-4 py-3 text-base border-2 border-reddit-gray-200 dark:border-slate-600 rounded-full
           bg-reddit-gray-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100 transition-all duration-200 placeholder-reddit-gray-400 dark:placeholder-slate-400
           focus:outline-none focus:border-reddit focus:ring-2 focus:ring-reddit-100 dark:focus:ring-orange-900/50 focus:bg-white dark:focus:bg-slate-800;
  }

  .label {
    @apply block text-sm font-medium text-reddit-gray-600 dark:text-slate-300 mb-2;
  }

  /* Reddit-style badges */
  .badge {
    @apply inline-flex items-center px-3 py-1 text-sm font-medium rounded-full;
  }

  .badge-positive {
    @apply badge bg-accent-100 dark:bg-green-900/30 text-accent-700 dark:text-green-400;
  }

  .badge-negative {
    @apply badge bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400;
  }

  .badge-neutral {
    @apply badge bg-reddit-gray-100 dark:bg-slate-700 text-reddit-gray-600 dark:text-slate-300;
  }

  .badge-reddit {
    @apply badge bg-reddit-100 dark:bg-orange-900/30 text-reddit-700 dark:text-orange-400;
  }

  /* Reddit-style step indicators */
  .step-indicator {
    @apply flex items-center justify-center w-10 h-10 rounded-full font-semibold
           transition-all duration-300;
  }

  .step-indicator-active {
    @apply step-indicator bg-reddit text-white ring-4 ring-reddit-100 dark:ring-orange-900/50;
  }

  .step-indicator-completed {
    @apply step-indicator bg-accent-500 text-white;
  }

  .step-indicator-pending {
    @apply step-indicator bg-reddit-gray-200 dark:bg-slate-700 text-reddit-gray-500 dark:text-slate-400;
  }

  /* Reddit gradient text */
  .gradient-text {
    @apply bg-gradient-reddit bg-clip-text text-transparent;
  }

  .section-title {
    @apply text-2xl md:text-3xl font-bold text-slate-900 dark:text-white;
  }

  .section-subtitle {
    @apply text-lg text-reddit-gray-500 dark:text-slate-400;
  }

  /* Reddit-style upvote/downvote colors */
  .upvote {
    @apply text-reddit hover:bg-reddit-50 dark:hover:bg-orange-900/30;
  }

  .downvote {
    @apply text-secondary-500 hover:bg-secondary-50 dark:hover:bg-blue-900/30;
  }

  /* Reddit-style post card */
  .reddit-card {
    @apply bg-white dark:bg-slate-800 border border-reddit-gray-200 dark:border-slate-700 rounded-lg overflow-hidden
           hover:border-reddit-gray-300 dark:hover:border-slate-600 transition-colors;
  }

  /* Reddit-style subreddit chip */
  .subreddit-chip {
    @apply inline-flex items-center gap-1 px-2 py-0.5 bg-reddit-100 dark:bg-orange-900/30 text-reddit-700 dark:text-orange-400
           rounded-full text-xs font-medium hover:bg-reddit-200 dark:hover:bg-orange-900/50 transition-colors cursor-pointer;
  }
}

@layer utilities {
  /* Screen reader only - for accessibility */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Skip to main content link for keyboard users */
  .skip-link {
    @apply absolute -top-10 left-0 bg-reddit text-white px-4 py-2 z-[100] focus:top-0 transition-all;
  }

  /* Focus visible only (not on click) */
  .focus-visible-only:focus:not(:focus-visible) {
    outline: none;
    box-shadow: none;
  }

  /* Reddit wave pattern */
  .wave-pattern {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23FF4500' fill-opacity='0.1' d='M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: bottom;
    background-size: 100% auto;
  }

  .slider-track {
    @apply h-2 bg-reddit-gray-200 dark:bg-slate-700 rounded-full cursor-pointer;
  }

  .slider-thumb {
    @apply w-5 h-5 bg-reddit rounded-full shadow-md cursor-grab
           hover:bg-reddit-dark active:cursor-grabbing;
  }

  .animation-float {
    animation: float 3s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  .animation-pulse-soft {
    animation: pulseSoft 2s ease-in-out infinite;
  }

  @keyframes pulseSoft {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.7;
    }
  }

  /* Dark mode image adjustments */
  .dark img:not([class*="no-dark-filter"]) {
    /* Slightly reduce brightness in dark mode for better eye comfort */
    filter: brightness(0.95);
  }

  .dark img[class*="logo"],
  .dark img[class*="icon"] {
    /* Don't adjust logos or icons */
    filter: none;
  }
}

/* Custom scrollbar - Reddit style */
/* Firefox standard properties */
* {
  scrollbar-width: thin;
  scrollbar-color: #CBD5E1 #F1F5F9;
}

.dark * {
  scrollbar-color: #475569 #1e293b;
}

/* WebKit (Chrome, Safari, Edge) scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  @apply bg-slate-100 dark:bg-slate-800;
}

::-webkit-scrollbar-thumb {
  @apply bg-slate-300 dark:bg-slate-600 rounded-md hover:bg-slate-400 dark:hover:bg-slate-500 transition-colors;
}

::-webkit-scrollbar-thumb:active {
  @apply bg-slate-500 dark:bg-slate-400;
}

/* Hide scrollbar utility */
.no-scrollbar::-webkit-scrollbar {
  display: none;
}
.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

/* Date picker customization - Reddit themed */
.react-datepicker {
  @apply font-sans border border-reddit-gray-200 dark:border-slate-700 rounded-lg shadow-reddit dark:bg-slate-800 !important;
}

.react-datepicker__header {
  @apply bg-reddit-50 dark:bg-slate-700 border-b border-reddit-gray-200 dark:border-slate-600 !important;
}

.react-datepicker__day--selected,
.react-datepicker__day--in-range {
  @apply bg-reddit hover:bg-reddit-dark !important;
}

.react-datepicker__day--keyboard-selected {
  @apply bg-reddit-200 dark:bg-orange-900/50 !important;
}

.dark .react-datepicker__day {
  @apply text-slate-200;
}

.dark .react-datepicker__day:hover {
  @apply bg-slate-600;
}

.dark .react-datepicker__day-name,
.dark .react-datepicker__current-month {
  @apply text-slate-200;
}

/* Drag and drop styles - Reddit themed */
.dragging {
  @apply opacity-50 ring-2 ring-reddit !important;
}

.drop-target {
  @apply bg-reddit-50 border-2 border-dashed border-reddit !important;
}

/* Loading skeleton */
.skeleton {
  @apply bg-reddit-gray-200 dark:bg-slate-700 animate-pulse rounded-lg;
}

/* Map container */
.map-container {
  @apply w-full h-[400px] rounded-lg overflow-hidden shadow-reddit dark:shadow-slate-900/50;
}

/* Leaflet zoom controls positioning and styling */
.leaflet-control-zoom {
  @apply border-none shadow-lg;
}

.leaflet-control-zoom a {
  @apply bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 transition-colors;
}

.leaflet-control-zoom a:hover {
  @apply bg-slate-50 dark:bg-slate-700 border-slate-300 dark:border-slate-600;
}

.leaflet-control-zoom a:first-child {
  @apply rounded-t-lg;
}

.leaflet-control-zoom a:last-child {
  @apply rounded-b-lg border-t-0;
}

/* Leaflet popup styling for dark mode */
.dark .leaflet-popup-content-wrapper,
.dark .leaflet-popup-tip {
  @apply bg-slate-800 text-slate-100 shadow-xl;
}

.dark .leaflet-popup-content-wrapper {
  @apply border border-slate-700;
}

/* Smooth transitions for Leaflet tile changes */
.leaflet-tile-container {
  transition: opacity 300ms ease-in-out;
}

/* Reddit-style selection highlight */
::selection {
  @apply bg-reddit-200 dark:bg-orange-900/50 text-reddit-900 dark:text-orange-100;
}

/* Reddit-style focus ring - scoped to interactive elements only */
a:focus-visible,
button:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[tabindex]:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[role="switch"]:focus-visible,
[role="tab"]:focus-visible,
[role="checkbox"]:focus-visible,
[role="radio"]:focus-visible,
summary:focus-visible {
  @apply outline-none ring-2 ring-reddit dark:ring-orange-500 ring-offset-2 dark:ring-offset-slate-900;
}

/* Safe area inset utilities for mobile notch/home indicator */
.safe-area-inset-top {
  padding-top: env(safe-area-inset-top, 0px);
}

.safe-area-inset-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.safe-area-inset-left {
  padding-left: env(safe-area-inset-left, 0px);
}

.safe-area-inset-right {
  padding-right: env(safe-area-inset-right, 0px);
}

/* Margin variants for safe areas */
.safe-area-margin-top {
  margin-top: env(safe-area-inset-top, 0px);
}

.safe-area-margin-bottom {
  margin-bottom: env(safe-area-inset-bottom, 0px);
}

/* Shorthand for all safe area padding */
.safe-area-inset {
  padding-top: env(safe-area-inset-top, 0px);
  padding-bottom: env(safe-area-inset-bottom, 0px);
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
}

/* Reduced motion preference - disable animations for users who prefer reduced motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .card,
  .reddit-card {
    border-width: 2px;
  }

  .btn-primary,
  .btn-secondary,
  .btn-accent {
    border: 2px solid currentColor;
  }
}

/* Print styles for travel itineraries */
@media print {
  /* Reset backgrounds for printing */
  body {
    background: white !important;
    color: black !important;
    font-size: 12pt;
  }

  /* Hide non-essential UI elements when printing */
  header,
  footer,
  nav,
  .no-print,
  .safe-area-inset-top,
  .safe-area-inset-bottom,
  button:not(.print-include),
  [role="switch"],
  .fixed,
  .sticky {
    display: none !important;
  }

  /* Ensure cards print cleanly */
  .card,
  .reddit-card,
  .card-interactive,
  .card-selected {
    border: 1px solid #ccc !important;
    box-shadow: none !important;
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Ensure links show their URL */
  a[href^="http"]::after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }

  /* Disable dark mode overrides for print */
  .dark {
    color-scheme: light;
  }

  /* Badges should print with borders instead of backgrounds */
  .badge,
  .badge-positive,
  .badge-negative,
  .badge-neutral,
  .badge-reddit {
    border: 1px solid #999 !important;
    background: transparent !important;
    color: black !important;
  }

  /* Maps don't print well - hide the map content but keep the container
     visible so the ::after fallback message can render */
  .map-container {
    height: auto !important;
    min-height: 2em;
    box-shadow: none !important;
    overflow: visible !important;
  }

  .map-container > * {
    display: none !important;
  }

  /* Show a print-friendly message for map areas */
  .map-container::after {
    content: "[Map - see online version]";
    display: block;
    font-style: italic;
    color: #666;
  }
}
